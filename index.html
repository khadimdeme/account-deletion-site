<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <title>Suppression de compte - Alo Région</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body{font-family:system-ui,Arial;padding:20px;max-width:720px;margin:auto;line-height:1.5}
    input,textarea,button{font:inherit}
    .ok{color:#137333}.err{color:#b3261e}
  </style>
</head>
<body>
  <h1>Demander la suppression de votre compte</h1>

  <p>Entrez l’adresse e-mail utilisée dans l’application. Votre compte sera désactivé tout de suite puis
  supprimé définitivement sous 30 jours. Vous pouvez annuler en vous reconnectant avant l’échéance.</p>

  <form id="f">
    <label>E-mail</label><br/>
    <input type="email" name="email" required style="width:100%;padding:10px" /><br/><br/>
    <label>Raison (facultatif)</label><br/>
    <textarea name="reason" rows="4" style="width:100%;padding:10px"></textarea><br/><br/>
    <button type="submit" style="padding:10px 16px">Envoyer la demande</button>
  </form>

  <p id="m" aria-live="polite"></p>

  <hr/>
  <p>Besoin d’aide ? Écrivez-nous : <a href="mailto:contact@aloregion.com">contact@aloregion.com</a><br/>
  Lien Play Store : <a href="https://play.google.com/store/apps/details?id=APP_ID_A_METTRE_PLUS_TARD" target="_blank" rel="noopener">Alo Région (bientôt)</a></p>

  <script>
    const form = document.getElementById('f');
    const msg  = document.getElementById('m');
    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      msg.textContent = 'Envoi en cours…';
      const data = Object.fromEntries(new FormData(form).entries());
      try {
        const r = await fetch('/api/request-deletion', {
          method: 'POST',
          headers: {'Content-Type':'application/json'},
          body: JSON.stringify(data)
        });
        const t = await r.text();
        msg.className = r.ok ? 'ok' : 'err';
        msg.textContent = t || (r.ok ? 'OK' : 'Erreur');
        if (r.ok) form.reset();
      } catch (err) {
        msg.className = 'err';
        msg.textContent = 'Erreur réseau.';
      }
    });
  </script>
</body>
</html>
